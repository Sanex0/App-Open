<!-- Centralized flash/toast include -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% set toast_cls = 'danger' if category in ['error', 'danger'] else category %}
                {# data-delay and data-autohide allow per-flash customization if needed #}
                <div class="toast align-items-center text-bg-{{ toast_cls }} border-0 shadow-lg mb-2 fade" role="alert" aria-live="assertive" aria-atomic="true" data-delay="4000" data-autohide="true">
                    <div class="d-flex">
                        <div class="toast-body">{{ message|safe }}</div>
                        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function(){
    var toastEls = document.querySelectorAll('.toast');
    toastEls.forEach(function(el){
        try{
            // read data attributes and pass them as options to the Toast constructor
            var autohide = true;
            var delay = 4000;
            try{
                var da = el.getAttribute('data-autohide');
                if(da !== null) autohide = (da === 'true' || da === '1');
                var dd = el.getAttribute('data-delay') || el.getAttribute('data-bs-delay') || el.getAttribute('data-delay');
                if(dd) delay = parseInt(dd, 10) || delay;
            } catch(e){}
            var toast = new bootstrap.Toast(el, { autohide: autohide, delay: delay });
            toast.show();
            // pause autohide on hover: clear timeout on mouseenter, restart on mouseleave
            el.addEventListener('mouseenter', function(){
                try{ if(toast._timeout) { clearTimeout(toast._timeout); toast._timeout = null; } }catch(e){}
            });
            el.addEventListener('mouseleave', function(){
                try{ if(!toast._timeout && autohide){ toast._timeout = setTimeout(function(){ toast.hide(); }, delay); } }catch(e){}
            });
        }catch(e){console.log('toast init err', e);} 
    });
});
</script>

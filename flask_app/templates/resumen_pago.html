<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resumen de Pago | Club Recrear</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">

    <style>
        /* --- 1. ESTRUCTURA BASE --- */
        html, body { width: 100%; overflow-x: hidden; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #eef2f7;
            min-height: 100vh;
            display: block;
            padding-bottom: 110px;
            animation: fadeIn 0.6s ease-out;
            
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        } 
        @media (min-width: 768px) { body { padding-bottom: 40px; padding-top: 40px; } }

        /* --- 2. ESTILOS DE TARJETA --- */
        .header-title { font-weight: 600; font-size: 1.4rem; margin: 0; }
        
        .badge-qty {
            background-color: #e9ecef; color: #495057; 
            padding: 5px 10px; border-radius: 8px; font-size: 0.85rem;
        }

        /* --- VISTA PC --- */
        @media (min-width: 768px) {
            .main-card {
                background: white; border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 91, 168, 0.15); overflow: hidden;
                width: 100%; max-width: 800px; margin: 0 auto; 
            }
            .card-header-custom {
                background-color: #005ba8; padding: 30px 20px;
                text-align: center; color: white; border-bottom: none;
            }
            .table thead th {
                background-color: #f8f9fa; color: #005ba8; font-weight: 600; border-bottom: 2px solid #e1e5e9;
            }
            .table tbody td { padding: 15px; vertical-align: middle; border-bottom: 1px solid #f1f1f1;}
            
            .pc-total-section {
                background-color: #f8f9fa; border-radius: 15px; padding: 20px;
                margin-top: 20px; text-align: right;
            }
            .total-label { font-size: 1.1rem; color: #6c757d; }
            .total-amount { color: #005ba8; font-size: 2rem; font-weight: 700; line-height: 1; }
        }

        /* --- VISTA MÃ“VIL --- */
        @media (max-width: 767px) {
            .container { padding-left: 12px; padding-right: 12px; }
            .main-card { width: 100%; margin: 0 auto; }

            .card-header-custom {
                background-color: #005ba8; padding: 20px; text-align: center;
                color: white; margin-bottom: 20px; border-radius: 0 0 20px 20px;
            }

            thead { display: none; }
            table, tbody { display: block; width: 100%; }
            tr {
                display: block; background: white; border-radius: 15px;
                margin-bottom: 12px; padding: 15px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid #fff;
            }
            td { display: block; padding: 0; border: none; }

            .mobile-product-name { font-weight: 600; color: #212529; font-size: 1rem; margin-bottom: 5px; }
            .mobile-row-details { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
            .mobile-price-unit { font-size: 0.8rem; color: #6c757d; }
            .mobile-subtotal { font-weight: 700; color: #005ba8; font-size: 1.1rem; }

            .sticky-checkout-bar {
                position: fixed; bottom: 0; left: 0; width: 100%;
                background: white; z-index: 1000; padding: 15px 20px;
                box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
                display: flex; justify-content: space-between; align-items: center;
                border-top: 1px solid #eef2f7;
            }
            .checkout-total-label { font-size: 0.8rem; text-transform: uppercase; color: #6c757d; display: block; }
            .checkout-total-value { font-size: 1.3rem; font-weight: 700; color: #005ba8; line-height: 1.1; }
        }

        .btn-primary { background-color: #005ba8; border: none; }
        .btn-primary:hover { background-color: #004a8a; transform: translateY(-1px); }
        .btn-outline-secondary { border-color: #dee2e6; color: #6c757d; }

    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                
                <div class="main-card">
                    
                    <div class="card-header-custom">
                        <img src="{{ url_for('static', filename='logo-club-recrear.svg') }}" alt="Logo" width="140" class="mb-2">
                        <p class="header-title">Resumen de compra</p>
                    </div>

                    <div class="card-body p-0 p-md-4 mb-md-3"> 
                        <div class="table-responsive-md">
                            <table class="table mb-0">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th class="text-center">Cantidad</th>
                                        <th class="text-end">Precio Unit.</th>
                                        <th class="text-end">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for producto in productos %}
                                    <tr>
                                        <td>
                                            <div class="d-md-none mobile-product-name">{{ producto.nombre }}</div>
                                            <div class="d-none d-md-block fw-bold">{{ producto.nombre }}</div>
                                            
                                            <div class="d-md-none mobile-row-details">
                                                <div>
                                                    <span class="badge-qty">x{{ producto.cantidad }}</span>
                                                    <span class="mobile-price-unit ms-2">${{ "{:,.0f}".format(producto.precio).replace(',', '.') }} c/u</span>
                                                </div>
                                                <div class="mobile-subtotal">
                                                    ${{ "{:,.0f}".format(producto.precio * producto.cantidad).replace(',', '.') }}
                                                </div>
                                            </div>
                                        </td>
                                        
                                        <td class="text-center d-none d-md-table-cell">
                                            <span class="badge-qty">{{ producto.cantidad }}</span>
                                        </td>
                                        <td class="text-end d-none d-md-table-cell text-muted">
                                            ${{ "{:,.0f}".format(producto.precio).replace(',', '.') }}
                                        </td>
                                        <td class="text-end d-none d-md-table-cell fw-bold text-primary">
                                            ${{ "{:,.0f}".format(producto.precio * producto.cantidad).replace(',', '.') }}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <div class="d-none d-md-block">
                            <div class="pc-total-section d-flex justify-content-between align-items-center">
                                <span class="total-label">Total a Pagar:</span>
                                <span class="total-amount">${{ "{:,.0f}".format(total).replace(',', '.') }}</span>
                            </div>

                            <div class="d-flex gap-3 justify-content-end mt-4 align-items-center">
                                <a href="/caja/{{ id_caja }}" class="btn btn-outline-secondary rounded-pill px-4">
                                    <i class="bi bi-arrow-left me-2"></i>Volver
                                </a>
                                
                                <form method="get" action="/datos_cliente" class="m-0">
                                    <input type="hidden" name="id_caja" value="{{ id_caja }}">
                                    <input type="hidden" name="productos" value="{{ productos_json | safe }}">
                                    <input type="hidden" name="total" value="{{ total }}">
                                    
                                    <button type="submit" class="btn btn-primary rounded-pill px-4 py-2">
                                        Confirmar Pago <i class="bi bi-check-circle-fill ms-2"></i>
                                    </button>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-md-none sticky-checkout-bar">
        <div class="d-flex flex-column justify-content-center">
            <span class="checkout-total-label">Total a Pagar</span>
            <span class="checkout-total-value">${{ "{:,.0f}".format(total).replace(',', '.') }}</span>
        </div>

        <div class="d-flex gap-2 align-items-center">
            <a href="/caja/{{ id_caja }}" class="btn btn-outline-secondary rounded-pill px-3">
                <i class="bi bi-arrow-left"></i>
            </a>
            
            <form method="get" action="/datos_cliente" class="m-0">
                <input type="hidden" name="id_caja" value="{{ id_caja }}">
                <input type="hidden" name="productos" value="{{ productos_json | safe }}">
                <input type="hidden" name="total" value="{{ total }}">
                
                <button type="submit" class="btn btn-primary rounded-pill px-4 py-2 shadow">
                    Pagar <i class="bi bi-chevron-right ms-1"></i>
                </button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>